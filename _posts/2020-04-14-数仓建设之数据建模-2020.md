---
layout:     post
title:      数仓建设
subtitle:   数仓建设之数据建模
date:       2020-04-14
author:     MichealHu
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - 数仓
---

# 数仓建设之数据建模



所谓水无常势，兵无常法。不同的行业有不同行业的特点，不同的企业也有自己的业务体系。对应的数据模型也有可能千差万别。目前在电商领域笔者所接触到数据建模方法论基本采用维度建模方式。而现在提出如下三个问题：

1. 为什么需要数据建模？
2. 如何从0到1搭建数据仓库？



## 一、概述

随着DT时代的来临，互联网、智能终端设备和其它信息技术的快速发展，导致数据成爆发式增长，而对于企业来讲，需要将这些业务数据进行有结构的分类存储，以便于服务企业的业务等部门。数据模型就是数据组织和存储的方法。它强调从业务、数据存取和使用角度合理存储数据。构建出适合企业的数据模型体现在如下几个方面：

1. 提高数据查询性能；
2. 缩减企业成本；
3. 提高数据使用效率；
4. 改善数据质量。

目前，数据建模方法论主要有如下几种：

1. 数据仓库之父 Bill lnmon提出的ER模型；
2. 数据仓库领域的 Ralph Kimball 提出的维度建模。

而本文主要以企业应用的角度阐述维度建模方法论和数仓数据建模的过程。

## 二、数仓建设过程

在笔者工作过程中，碰到的一个最大的问题就是如何从0到1去搭建数据仓库，从而更好的服务企业业务部门。

数据仓库建设的过程可以分为：

1. 业务调研；
2. 构建业务矩阵；
3. 划分数据域；
4. 构建总线矩阵，明确统计指标；
5. 数据建模；
6. 脚本开发。

### 2.1 业务调研

首先构建数据仓库，需要对公司业务系统的业务进行全面了解，构建业务矩阵。数据仓库首先服务的是数据分析部门，前期更多的可能是报表需求。

### 2.2 构建业务矩阵







## 三、数据建模

### 2.1  建模设计

### 2.2  数据域建模

### 2.3  逻辑建模

### 2.4  物理建模

## 三、事实表

###  3.1  事务事实表

事务事实表设计过程：

1. 选择业务过程
2. 确定粒度
3. 确定维度
4. 确定事实
5. 冗余维度，也叫作退化维度

单事务事实表：针对每个业务过程设计一个事实表。优点是：可以方便地对每个业务过程进行独立的分析研究。选定业务过程后，将对每个业务过程确定粒度、维度和事实。

多事务事实表：将不同的事实放到同一个事实表中，即同一个事实表包含不同的业务过程。多事务事实表在设计时有两种方法进行事实的处理：①不同业务过程的事实使用不同的事实字段进行存放：①不同业务过程的事实使用同一个事实字段进行存放，但增加一个业务过程标签。

多事务事实表设计的两种场景和方式：

1. 当不同业务过程的度量比较相似、差异不大时：使用同一个字段来表示度量数据。
2. 当不同业务过程的度量差异较大时：将不同业务过程的度量使用不同字段冗余到表中，非当前业务过程则置零表示。

事实的设计准则：

1. 事实完整性：
2. 事实一致性：
3. 事实可加性：

### 3.2  周期快照事实表

特性：

1. 用快照采样状态
2. 快照粒度
3. 密度和稀疏性
4. 半可加性

快照事实表的设计步骤：

1. 确定快照事实表的快照粒度。
2. 确定快照事实表采样的状态度量。

快照事实表常见分类：

1. 单维度的每天快照事实表
2. 混合维度的每天快照事实表
3. 全量快照事实表

一般来说，周期快照事实表可以从事务事实表进行汇总产出；或者直接使用操作型系统的数据作为周期快照事实表的数据源进行加工。

设计注意事项：

1. 事务与快照成对设计
2. 附加事实
3. 周期到日期度量

### 3.3 累计快照事实表

设计过程：

1. 选择业务过程
2. 确定粒度
3. 确定维度
4. 确定事实
5. 退化维度

特点：

1. 数据不断更新
2. 多业务过程日期

实现：

1. 第一种方式是全量表的形式。
2. 第二种方式是全量表的变化形式。
3. 第三种方式是以业务实体的结束时间分区。

## 四、维度表

数据仓库维度表设计可以概括为如下几个步骤：

1. 第一步：选择维度或新建维度。在企业级数据仓库中保证维度的唯一性。
2. 第二步：确定主维表。确定和业务系统同步的主维表，也就是确定该维度表对应的业务表。
3. 第三步：确定相关维表。数据仓库是所有业务源系统的数据整合，不同业务系统或者同业务系统中的不同表之间存在关联性。我们需要梳理业务，确定哪些表和主维表存在关联关系，并选择其中的某些表用于生成维度属性。
4. 第四步：确定维度属性。从主维表和相关维表中选择维度属性或生成新的维度属性。

在实现进行维度设计的时候有如下几个建议：

1. 尽可能生成丰富的维度属性；
2. 尽可能多地给出包括一些富有意义的文字性描述；
3. 区分数值型属性和事实；
4. 尽量沉淀出通用的维度属性。

一致性维度和交叉探查

维度设计高级主题


1. 维度的层次结构；
2. 规范化和反规范化；
3. 一致性维度和交叉探查；



垂直整合和水平整合

垂直拆分和水平拆分

## 参考资料







## 参考资料

1. [浅谈数据仓库建设中的数据建模方法](https://www.ibm.com/developerworks/cn/data/library/techarticles/dm-0803zhousb/index.html)
2. [美团点评酒旅数据仓库建设实践](https://tech.meituan.com/2017/05/26/hotel-dw-layer-topic.html)
3. [马蜂窝数据中台起步建设：数仓的架构、模型与应用](https://dbaplus.cn/news-141-2815-1.html)
4. [数据仓库实践之业务数据矩阵的设计](https://cloud.tencent.com/developer/article/1396893)
5. [数据仓库开发技巧](https://github.com/dantezhao/data-warehouse/blob/master/the-tips-of-data-warehouse.md)