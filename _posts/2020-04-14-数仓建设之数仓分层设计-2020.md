---
layout:     post
title:      数仓建设
subtitle:   数仓建设之数仓分层设计
date:       2020-04-14
author:     MichealHu
header-img: img/post-bg-ios9-web.jpg
catalog: true
tags:
    - 数仓
---

# 数仓建设实践之数仓分层设计

## 一、数仓分层意义

数仓分层的意义可以描述为：
- 清晰数据结构：每一个数据分层都有它的作用域，这样我们在使用表的时候能更方便地定位和理解。
- 数据血缘追踪：在实际应用中，我们最终给业务方呈现的是一张能直接使用的业务表，但实际处理中它的数据可能有很多来源，如果有一张来源表
出问题了，我们希望能够快速准确地定位到问题，并清楚它的危害范围。采用数仓分层可以很快实现数据血缘追踪。
- 减少重复开发：规范数据分层，开发一些通用的中间层数据，能够减少极大的重复计算。
- 复杂问题简单化：将一个复杂任务分解成多个步骤来完成，每一层只处理单一的逻辑，比较简单和容易理解。而且便于维护数据的准确性，当数据
出现问题后，可以不用修复所有的数据，只需要从有问题的步骤开始修复。屏蔽原始数据的异常。
- 屏蔽业务的影响：不必改一次业务就需要重新接入数据。

## 二、数仓分层设计

笔者结合公司业务场景和数据模型架构将数仓分为如下几层：
- ODS：数据操作层。
- CDM：公共维度模型层，该层又可细分为DWD层和DWS层。
    - DWD：数据明细层。
    - DWS：数据汇总层。
- ADS：数据应用层。

![数仓分层架构图](https://github.com/hufenggang/hufenggang.github.io/blob/master/img/page003/数仓分层.jpg?raw=true)

下面针对每一层进行详细说明：

### 2.1 ODS层

#### 定义

ODS层（数据操作层）相当于数据准备区，主要存储记录数据和历史变化数据。ODS层的设计目的是将源数据无处理地接入数据仓库中，所以该层的表结构最好和源数
据结构保存一致。

#### 主要工作

ODS层的主要工作有如下几部分：
1. 数据同步：结构化数据（公司业务数据）以增量或全量的方式同步到ODS层；
2. 数据结构化：针对如用户点击流等日志的非结构化数据，进行结构化处理存储到ODS层。
3. 脏数据清洗：针对同步过来的日志数据，对无效记录或非法记录实现数据清洗。

#### 技术实现

模型设计依据业务表数据变更特性采取拉链表、流水表两种形式：
- 拉链表：维护历史状态，以及最新状态数据的一种表，拉链表根据拉链粒度的不同，实际上相当于快照，只不过做了优化，去除了一部分不变的记
录而已,通过拉链表可以很方便的还原出拉链时点的客户记录。
- 流水表：对于表的每一个修改都会记录，可以用于反映实际记录的变更。

### 2.2. CDM层

CDM层（公共维度模型层）的主要作用是完成数据加工与整合、建立一致性的维度、构建可复用的面向分析和统计的明细事实表、维度数据表以及汇
总指标数据表。又可细分为：DWD（数据明细层）、DWS（数据汇总层）和DIM（公共维度层）。

CDM层采用维度模型方法作为理论基础，更多的采用一些维度游湖的手段。

#### 2.2.1 DWD层

DWD：数据明细层。以业务过程为建模驱动，基于每个具体业务过程的特点，构建最细粒度的明细层事实表。
以分析的主题对象为建模驱动，基于上层的应用和产品的指标需求，构建公共粒度的汇总指标事实表，以宽表化手段来物理化模型。


## 参考资料

1. [基于大数据的数据仓库分层实现](http://cxy7.com/articles/2017/06/24/1498268635086.html)
2. [数据仓库建设之分层设计思考笔记](https://zhuanlan.zhihu.com/p/51257980)